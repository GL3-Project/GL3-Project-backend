# Docker


# Build and push an image to Azure Container Registry
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
- main

resources:
- repo: self

variables:
  # Container registry service connection established during pipeline creation
  dockerRegistryServiceConnection: '2d53833f-c925-4d8d-abb3-8c95f520331f'
  imageRepository: 'gl3projectbackend'
  containerRegistry: 'gl3project.azurecr.io'
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'
  tag: '$(Build.BuildId)'

  # Agent VM image name
  vmImageName: 'ubuntu-latest'

stages:
- stage: Build
  displayName: Build and push stage
  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: $(vmImageName)
    steps:
  #  - task: Docker@2
   #   displayName: Build and push an image to container registry
    #  inputs:
   #     command: buildAndPush
   #     repository: $(imageRepository)
   #     dockerfile: $(dockerfilePath)
   #     containerRegistry: $(dockerRegistryServiceConnection)
   #     tags: latest
    - task: InstallSSHKey@0
      inputs:
        knownHostsEntry: |
          |1|fg/mfnfV1ecF5TR3s1XOmRbu9zI=|iST5r+JatJRzTEY1rf5U13j/98c= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
          |1|hB+MS5zIHKOqZBhDb+w/hkRoffs=|XY3zV/lVDdzcr8Ia3noyofmLuy4= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
        sshPublicKey: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCxz+7u4QgWvMmG2gCy/ZxNTTw5kZOaSXd/YBqZWBriUK3sxNwQTDUeWTFMWgJbboRg2XiF7n2W2IllAiOzQIRmLfFfhfkkzfQ7IeCwOwhjcrAa8XEUm2YCfBnVCrX9JTzu3JAeYGTV+UeDiENfnKU0VD6I43L2g30VYiXHFH+HelX+rlmvd9fogqKPMvGXl0YFii5aaTbOeoaT9FgtOcTeba1OyTGs9eGlGQ9LVQcD1IISKQtkgMnTH5xQ/rr846xQtUi7H0Smx1G2ni/YsrlOruHHZt3BmAuujdUSQ1X/x42nMi+aUGJO8ebZ8mUQdF5XYHil22hp1z+3cTaPpew/ByQKiqdUV6mzIFERJc1jP5EKUxfrdBGwPSbNOjYQYlcOQkZxXVhCnsy9dMeWTWDos4iQq9sE/xmG9/c5CAGztB7/xVFvDw7EviGMywbqcpChIakY/+zONVqYE1WZiM0Wdg1cmw33uKfAzdezyNyIa112CirsWPRzANZ2B2J5DU0= ppp@nestProject'
        sshKeySecureFile: 'idppprsa.pub'
    - task: SSH@0
      inputs:
        sshEndpoint: 'pppVM'
        runOptions: 'commands'
        commands: 'sudo docker run -d -p 80:80 gl3project.azurecr.io/gl3projectbackend:latest'
        readyTimeout: '20000'